<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Map.ABT.Dongtangnaw</title>

  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå + PWA -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2196f3">

  <style>
    html, body { height:100%; margin:0; font-family:'Kanit', sans-serif; overflow:hidden; }

    body{
      background: url('Background.png') no-repeat center center fixed;
      background-size: cover;
      display:flex; flex-direction:column;
    }

    header{
      display:flex; align-items:center; justify-content:center; gap:12px;
      background: rgba(0,100,0,.75); color:#fff; padding:8px;
      font-size:20px; font-weight:600; text-align:center;
      backdrop-filter: blur(3px); border-radius:8px; margin:8px;
    }
    header img{ height:50px; }

    .controls{
      display:flex; gap:8px; align-items:center; justify-content:center;
      padding:10px; margin:0 8px 8px;
      background: rgba(255,255,255,.85); backdrop-filter: blur(3px);
      box-shadow:0 1px 6px rgba(0,0,0,.12); border-radius:10px;
    }
    select{ font:inherit; padding:6px 10px; border-radius:6px; border:1px solid #ccc; min-width:240px; }

    #map-area{ flex:1; margin:8px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.25);
               background:rgba(255,255,255,.6); overflow:hidden; }

    .map-wrap{ position:relative; width:100%; height:100%; }
    #mapFrame{ width:100%; height:100%; border:0; }

    /* overlay ‡∏à‡∏≤‡∏á ‡πÜ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå + fullscreen */
    .overlay-top-right{
      position:absolute;
      top:8px;
      right:8px;
      width:120px;      /* ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏™‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° */
      height:44px;
      background: rgba(0,0,0,0.1); /* ‡∏à‡∏≤‡∏á ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ */
      border-radius:6px;
      z-index:5;
      pointer-events:auto; /* ‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ó‡∏ô iframe */
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢ */
    .fab{
      position:fixed; right:16px; z-index:10000;
      width:56px; height:56px; border:none; border-radius:50%;
      display:grid; place-items:center; color:#fff; cursor:pointer;
      box-shadow:0 8px 18px rgba(0,0,0,.28); font-size:22px;
    }
    #installBtn{ bottom:88px; background:#0ea5e9; } /* ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á */
    #refreshBtn{ bottom:20px; background:#22c55e; } /* ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä */

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ SW ‡πÉ‡∏´‡∏°‡πà) */
    #updateBtn{
      display:none;
      position:fixed; bottom:160px; right:16px;
      background:#ff9800; color:#fff;
      border:none; border-radius:8px;
      padding:10px 14px; font-size:16px;
      box-shadow:0 4px 10px rgba(0,0,0,0.25);
      z-index:10000; cursor:pointer;
    }

    /* ===== Splash / Loading ===== */
    #splash{
      position: fixed; inset: 0;
      display: grid; place-items: center;
      background: rgba(255,255,255,0.9);   /* ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏õ‡∏£‡πà‡∏á: rgba(165,214,167,.9) */
      backdrop-filter: blur(3px);
      z-index: 10050;
      opacity: 1; 
      transition: opacity .25s ease;
    }
    #splash.hide{ opacity: 0; pointer-events: none; }

    #splash .splash-logo{
      width: 96px; height: 96px; object-fit: contain; margin-bottom: 12px;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.2));
      animation: pop .45s ease both;
    }
    #splash .splash-text{
      margin: 0; font-weight: 600; font-size: 18px; color: #0f5132;
      text-shadow: 0 1px 0 rgba(255,255,255,.6);
    }
    @keyframes pop{
      from{ transform: scale(.9); opacity:.6 }
      to  { transform: scale(1);  opacity:1 }
    }
    @media (prefers-reduced-motion: reduce){
      #splash{ transition: none; }
      #splash .splash-logo{ animation: none; }
    }
  </style>
</head>
<body>

  <header>
    <img src="welcome.png" alt="Welcome">
    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (Select a Map)
    <img src="logo.png" alt="Logo">
  </header>

  <div class="controls">
    <label for="mapSelect">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà:</label>
    <select id="mapSelect">
      <option value="https://www.google.com/maps/d/embed?mid=1rCujO4jFJ2h2wSa_pnlcmrOaQPZNrhM&hl=th&ehbc=2E312F">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡∏ö‡∏•‡∏î‡∏á‡∏ï‡∏∞‡∏á‡∏≤‡∏ß (Map of Dong Ta Ngao Subdistrict) </option>
      <option value="https://www.google.com/maps/d/embed?mid=1zy3WJ1VOzjpWf1gJQ36VGh1TaB9_7L4&hl=th&ehbc=2E312F">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÇ‡∏ã‡∏•‡πà‡∏≤‡πÄ‡∏ã‡∏•‡∏•‡πå (Solar Power Pole Plan) </option>
      <option value="https://www.google.com/maps/d/embed?mid=1DS8CSBurVMUU-px6qC-HrWu8Wa5CCj0&hl=th&ehbc=2E312F">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏° (Flood Crisis Map) </option>
    </select>
  </div>

  <div id="map-area">
    <div class="map-wrap">
      <iframe id="mapFrame"
        src="https://www.google.com/maps/d/embed?mid=1rCujO4jFJ2h2wSa_pnlcmrOaQPZNrhM&hl=th&ehbc=2E312F"
        allowfullscreen></iframe>

      <!-- ‡πÅ‡∏ú‡πà‡∏ô‡πÉ‡∏™‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå + fullscreen -->
      <div class="overlay-top-right" title="‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á My Maps"></div>
    </div>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á + ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä + ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï -->
  <button id="installBtn" class="fab" title="‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ">‚¨á</button>
  <button id="refreshBtn" class="fab" title="‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä">‚ü≤</button>
  <button id="updateBtn">üîÑ ‡∏°‡∏µ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà ‚Äì ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</button>

  <!-- Splash / Loading overlay -->
  <div id="splash" aria-live="polite">
    <img src="logo.png" alt="" class="splash-logo">
    <p class="splash-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‚Ä¶</p>
  </div>

  <script>
    /* ===== ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ===== */
    const sel = document.getElementById('mapSelect');
    const frame = document.getElementById('mapFrame');
    const saved = localStorage.getItem('abt_selected_map_value');
    if (saved) { sel.value = saved; frame.src = saved; }
    sel.addEventListener('change', () => {
      // ‡πÅ‡∏™‡∏î‡∏á splash ‡∏ï‡∏≠‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
      showSplash('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‚Ä¶');
      frame.src = sel.value;
      localStorage.setItem('abt_selected_map_value', sel.value);
      // ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏ß‡∏¥
      const t = setTimeout(hideSplash, 2000);
      const onLoaded = () => { clearTimeout(t); hideSplash(); frame.removeEventListener('load', onLoaded); };
      frame.addEventListener('load', onLoaded);
    });

    /* ===== ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ iframe) ===== */
    document.getElementById('refreshBtn').addEventListener('click', () => {
      showSplash('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‚Ä¶');
      frame.src = frame.src;
      const t = setTimeout(hideSplash, 1500);
      const onLoaded = () => { clearTimeout(t); hideSplash(); frame.removeEventListener('load', onLoaded); };
      frame.addEventListener('load', onLoaded);
    });

    /* ===== PWA: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ===== */
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    function isStandalone(){
      return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
             || window.navigator.standalone;
    }
    function updateInstallBtn(){
      installBtn.hidden = isStandalone() || localStorage.getItem('abt_installed')==='1';
    }
    updateInstallBtn();

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      updateInstallBtn();
    });
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      installBtn.hidden = true;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    });
    window.addEventListener('appinstalled', () => {
      localStorage.setItem('abt_installed','1');
      updateInstallBtn();
    });

    /* ===== SW: ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ + ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà ===== */
    const updateBtn = document.getElementById('updateBtn');
    let newWorker;

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./sw.js');
          reg.update();                            // ‡πÄ‡∏ä‡πá‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
          setInterval(() => reg.update(), 15*60*1000);

          // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ SW ‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
          reg.addEventListener('updatefound', () => {
            newWorker = reg.installing;
            newWorker?.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                updateBtn.style.display = 'block';
              }
            });
          });

          // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SW ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -> ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î
          navigator.serviceWorker.addEventListener('controllerchange', () => location.reload());
        } catch (e) {
          console.warn('SW register failed', e);
        }
      });
    }

    // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï -> ‡πÉ‡∏´‡πâ SW ‡∏Ç‡πâ‡∏≤‡∏° waiting ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏á
    updateBtn.addEventListener('click', () => {
      if (newWorker) newWorker.postMessage({ action: 'SKIP_WAITING' });
    });

    /* ===== Splash helpers ===== */
    const splash = document.getElementById('splash');
    function showSplash(msg = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‚Ä¶') {
      const textEl = splash.querySelector('.splash-text');
      if (textEl) textEl.textContent = msg;
      splash.classList.remove('hide');
    }
    function hideSplash() {
      setTimeout(() => splash.classList.add('hide'), 100);
    }

    // ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å: ‡πÅ‡∏™‡∏î‡∏á splash ‡∏à‡∏ô iframe ‡πÇ‡∏´‡∏•‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏ß‡∏¥
    showSplash();
    const firstTimeout = setTimeout(hideSplash, 2000);
    frame.addEventListener('load', () => { clearTimeout(firstTimeout); hideSplash(); }, { once:true });
  </script>
</body>
</html>